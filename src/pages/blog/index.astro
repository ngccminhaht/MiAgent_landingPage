---
// Import các module và component cần thiết
import { getProcessedBlogData } from '../../lib/contentful'; // Import hàm mới đã xử lý dữ liệu
import BaseLayout from "../../layouts/BaseLayout.astro";       // Import Layout cơ bản
import BlogPostCard from '../../components/blog/BlogPostCard.astro'; // Component cho lưới
import FeaturedPost from '../../components/blog/FeaturedPost.astro'; // Component cho bài nổi bật

// DÒNG NÀY ĐÃ ĐƯỢC THAY THẾ (getBlogPosts)
// Import hàm fetch API từ service: (KHÔNG CẦN THIẾT NẾU DÙNG getProcessedBlogData)
// import { getBlogPosts } from '../../lib/contentful'; 

// =======================================================
// LẤY DỮ LIỆU ĐÃ XỬ LÝ VÀ TÁCH SẴN TỪ SERVICE
// =======================================================
// Code này KHÔNG THỂ THIẾU! Nó khởi tạo featuredPost và remainingPosts
const { blogEntries, featuredPost, remainingPosts } = await getProcessedBlogData();
---

<BaseLayout title="Danh Sách Blog | MiAgent"> <!-- Áp dụng Layout cho toàn trang -->
    <main class="container px-12 py-12">
        
        <!-- Header chính của Trang Blog (Giữ nguyên) -->
        

        <!-- ======================================================= -->
        <!-- HIỂN THỊ BÀI VIẾT NỔI BẬT (Featured Post - Dạng 2 cột) -->
        <!-- ======================================================= -->
        {featuredPost && <FeaturedPost post={featuredPost} />}

        <!-- Chỉ hiển thị lưới nếu có bài viết còn lại -->
        {remainingPosts.length > 0 && (
            <div class="mt-16">
                <!-- Tiêu đề cho các bài viết còn lại -->
                <h2 class="text-3xl font-bold mb-8">Top Articles</h2> 

                <!-- Container dạng lưới (Grid Layout) -->
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    {remainingPosts.map(post => (
                        // GỌI COMPONENT CARD VÀ TRUYỀN DỮ LIỆU
                        <BlogPostCard post={post} /> 
                    ))}
                </div>
            </div>
        )}
        
        <!-- Thông báo khi không có bài viết (Nếu chỉ có 1 bài nổi bật hoặc 0) -->
        {(blogEntries.length === 0 || remainingPosts.length === 0) && blogEntries.length > 0 && (
             <p class="text-lg col-span-full text-center mt-16">
                 Hiện chưa có bài viết nào khác trong danh sách.
             </p>
        )}
        {(blogEntries.length === 0) && (
             <p class="text-lg col-span-full text-center mt-16">
                 Hiện chưa có bài viết nào được xuất bản.
             </p>
        )}

    </main>
</BaseLayout>