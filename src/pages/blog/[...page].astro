---
// src/pages/blog/[...page].astro

// SỬA: Dùng alias @/ cho nhất quán với code của bạn
import { getProcessedBlogData } from '@/lib/contentful'; 
import BaseLayout from "@/layouts/BaseLayout.astro"; 
import BlogPostCard from '@/components/blog/BlogPostCard.astro'; 
import FeaturedPost from '@/components/blog/FeaturedPost.astro'; 



// FIX LỖI TYPE: Import 'type' của GetStaticPathsOptions
// @ts-ignore (Dùng nếu VS Code còn báo lỗi ảo)
import type { GetStaticPathsOptions } from 'astro';
import i18next from "../../i18n";
i18next.changeLanguage("vi");

// =======================================================
// TẠO TRANG TĨNH VÀ PHÂN TRANG (PAGINATION)
// ĐÂY LÀ HÀM MÀ ASTRO ĐANG YÊU CẦU
// =======================================================
export const getStaticPaths = async ({ paginate }: GetStaticPathsOptions) => {
  // 1. Lấy tất cả dữ liệu đã xử lý
  const { featuredPost, remainingPosts } = await getProcessedBlogData();

  // 2. Chỉ phân trang cho 'remainingPosts' (ví dụ: 49 bài)
  //    Chúng ta sẽ đặt số lượng bài lớn để hiển thị tất cả trên 1 trang
  return paginate(remainingPosts, {
    pageSize: 1000,
    // 3. Truyền 'featuredPost' vào TẤT CẢ các trang
    props: { featuredPost }
  });
};

// =======================================================
// LẤY DỮ LIỆU CHO TRANG HIỆN TẠI
// =======================================================
const { page, featuredPost } = Astro.props;

// const isPageOne = page.currentPage === 1; // Luôn là trang 1 vì đã bỏ phân trang
const postsForCurrentPage = page.data;
---

<BaseLayout title={i18next.t('blog.list.meta_title')}>
  <main class="container mx-auto px-4 md:px-8 lg:px-12 py-8 md:py-12">
    
    {featuredPost && <FeaturedPost post={featuredPost} />}

    {postsForCurrentPage.length > 0 && (
      <div class="mt-8 md:mt-16">
        <h2 class="text-3xl font-bold mb-8">{i18next.t('blog.list.all_posts')}</h2>

        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
          {postsForCurrentPage.map((post: any) => (
            <BlogPostCard post={post} /> 
          ))}
        </div>
      </div>
    )}
    
    {/* Đã bỏ Pagination theo yêu cầu */}

    {!featuredPost && postsForCurrentPage.length === 0 && (
       <p class="text-lg col-span-full text-center mt-16">
           {i18next.t('blog.list.no_posts')}
       </p>
    )}

  </main>
</BaseLayout>